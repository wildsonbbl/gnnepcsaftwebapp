{% extends "master.html" %}
{% load static %}
{% block title %}
  AI CHAT
{% endblock title %}
{% block content %}
  <div class="col-lg my-5">
    {% if show_form %}
      <form action="" method="post" id="submitGoogleApiKey">
        {% csrf_token %}
        <div class="row my-5 justify-content-center">
          <div class="col-md-6">
            {{ google_api_key_form.google_api_key }}
            <p class="mx-2 my-1">
              You can find more about Gemini API Keys
              <a href="https://ai.google.dev/gemini-api/docs/api-key" target="_blank">here</a>.
              This key is not stored for security reasons. The model <code>gemini-2.0-flash</code> is used.
            </p>
          </div>
          <div class="col-md-6">
            <input type="submit"
                   value="Submit Gemini API Key"
                   class="form-control btn-outline-primary" />
          </div>
        </div>
      </form>
      <div class="row my-1 justify-content-center">
        <ul>
          {% for error in google_api_key_form.google_api_key.errors %}
            <li class="alert alert-danger">{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% else %}
      <div class="row mb-3">
        <div class="col-md-12">
          <div class="d-flex justify-content-between align-items-center">
            <div class="dropdown">
              <button class="btn btn-outline-primary dropdown-toggle"
                      type="button"
                      id="sessionDropdown"
                      data-bs-toggle="dropdown"
                      aria-expanded="false">
                <span id="current-session-name">Current Session</span>
              </button>
              <ul class="dropdown-menu"
                  id="sessions-list"
                  aria-labelledby="sessionDropdown">
                <!-- Sessions will be populated here -->
              </ul>
            </div>
            <div>
              <button id="new-session-btn" class="btn btn-outline-success">New Session</button>
              <button id="rename-session-btn" class="btn btn-outline-secondary">Rename</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row d-flex justify-content-center" id="chatrow">
        <div class="col-md-12">
          <div class="card chat-card-style bg-light">
            <div id="chat-log" class="card-body overflow-auto"></div>
            <div class="row d-flex justify-content-center" id="formRow">
              <div class="col-lg-8">
                <div class="row my-1 justify-content-center">
                  <div class="col-sm-6 my-1">
                    <input id="chat-message-input"
                           class="form-control"
                           type="text"
                           placeholder="Write your message here" />
                  </div>
                  <div class="col-sm-2 my-1">
                    <input id="chat-message-submit"
                           type="submit"
                           value="send"
                           class="form-control btn-outline-primary" />
                  </div>
                  <div class="col-sm-2 my-1">
                    <input id="chat-log-save_button"
                           type="submit"
                           value="export"
                           class="form-control btn-outline-secondary" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
  {% if not show_form %}
    <script src={% static "js/chat.js" %}></script>
  {% endif %}
{% endblock content %}
